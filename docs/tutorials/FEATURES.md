# Photon 功能清单 (重构前基线)

## 核心功能

### 1. LLM 集成
- ✅ 多种 LLM API 支持 (Kimi, OpenAI 兼容)
- ✅ 工具调用 (Function Calling)
- ✅ 上下文管理和压缩
- ✅ 消息摘要

### 2. MCP 协议支持
- ✅ 外部 MCP 服务器集成
- ✅ 内置 MCP 工具实现
- ✅ 工具自动发现和注册
- ✅ 多服务器并行管理

### 3. 代码分析能力
- ✅ Tree-sitter AST 解析
- ✅ 正则表达式符号提取
- ✅ LSP 客户端集成 (多语言支持)
- ✅ 符号索引和搜索
- ✅ 语义向量搜索
- ✅ 调用图分析

### 4. 文件操作
- ✅ 智能文件读取 (符号/范围/窗口模式)
- ✅ 行级精确编辑
- ✅ 批量编辑
- ✅ 搜索替换
- ✅ 目录树浏览
- ✅ Git 集成 (diff, undo)

### 5. 技能系统
- ✅ 内置专家技能
- ✅ 外部技能加载
- ✅ YAML frontmatter 解析
- ✅ 技能同步机制

### 6. 工具集
- ✅ Bash 命令执行
- ✅ Python 沙箱
- ✅ LSP 导航 (定义/引用)
- ✅ 诊断检查
- ✅ 长期记忆存储
- ✅ 任务调度

### 7. 安全机制
- ✅ 高风险操作确认
- ✅ Bash 读取命令拦截
- ✅ 文件备份
- ✅ Git 回退支持

### 8. 用户界面
- ✅ CLI 模式
- ✅ Markdown 渲染
- ✅ Git diff 展示
- ✅ 状态栏显示
- ✅ 快捷命令 (tools/skills/lsp/memory/undo/clear)

## 需要保留的功能

重构后必须确保以上所有功能仍然可用。

## 已知问题

1. ❌ 决策层与执行层耦合 (InternalMCPClient 承担过多职责)
2. ❌ 缺少真正的 Agent Runtime (没有 Plan→Act→Observe 循环)
3. ❌ 上下文和记忆混淆 (记忆数据浪费 token)
4. ❌ 工具承担了太多智能 (应该极简极笨)
5. ❌ 无法从失败中学习

## 重构目标

将以上功能重新组织为:
- **Agent 层**: 智能决策和循环
- **Tool 层**: 极简原子工具
- **Memory 层**: 结构化记忆
- **Analysis 层**: 私有分析能力
